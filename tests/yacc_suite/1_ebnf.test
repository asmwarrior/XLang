%type<symbol_value> program statement expression // program_0 program_1 statement_0 statement_1

%%

root:
      program { tree_context()->root() = $1; YYACCEPT; }
    | error   { yyclearin; /* yyerrok; YYABORT; */ }
    ;

// ORIGINAL:
//program:
//      statement             { $$ = $1; }
//    | program ',' statement { $$ = MAKE_SYMBOL(',', 2, $1, $3); }
//    ;

// EBNF:
// [
program:
      (
            statement ',' { /* AAA */ $$ = $1; }
      )* statement        { /* BBB */ $$ = $1 ? MAKE_SYMBOL(',', 2, $1, $2) : $2; }
    ;
// ]

// EBNF-EXPANDED:
//program:
//      program_0 statement { /* BBB */ $$ = $1 ? MAKE_SYMBOL(',', 2, $1, $2) : $2; }
//    ;
//
//program_0:
//      /* empty */         {           $$ = NULL; }
//    | program_0 program_1 { /* BBB */ $$ = $1 ? MAKE_SYMBOL(',', 2, $1, $2) : $2; }
//    ; // TODO: is it necessary to repeat this action (BBB) ?
//
//program_1:
//      statement ',' { /* AAA */ $$ = $1; }
//    ;

// ORIGINAL:
//statement:
//      expression              { $$ = $1; }
//    | ID_IDENT '=' expression { $$ = MAKE_SYMBOL('=', 2, MAKE_TERM(ID_IDENT, $1), $3); }
//    ;

// EBNF:
// [
statement:
      (
            ID_IDENT '=' { /* CCC */ $$ = MAKE_TERM(ID_IDENT, $1); }
      )? expression      { /* DDD */ $$ = MAKE_SYMBOL('=', 2, $1, $2); }
    ;
// ]

// EBNF-EXPANDED:
//statement:
//      statement_0 expression { /* DDD */ $$ = MAKE_SYMBOL('=', 2, $1, $2); }
//    ;
//
//statement_0:
//      /* empty */ { $$ = NULL; }
//    | statement_1 { $$ = $1; }
//    ;
//
//statement_1:
//      ID_IDENT '=' { /* CCC */ $$ = MAKE_TERM(ID_IDENT, $1); }
//    ;

expression:
      ID_INT                         { $$ = MAKE_TERM(ID_INT, $1); }
    | ID_FLOAT                       { $$ = MAKE_TERM(ID_FLOAT, $1); }
    | ID_IDENT                       { $$ = MAKE_TERM(ID_IDENT, $1); }
    | '-' expression %prec ID_UMINUS { $$ = MAKE_SYMBOL(ID_UMINUS, 1, $2); }
    | expression '+' expression      { $$ = MAKE_SYMBOL('+', 2, $1, $3); }
    | expression '-' expression      { $$ = MAKE_SYMBOL('-', 2, $1, $3); }
    | expression '*' expression      { $$ = MAKE_SYMBOL('*', 2, $1, $3); }
    | expression '/' expression      { $$ = MAKE_SYMBOL('/', 2, $1, $3); }
    | '(' expression ')'             { $$ = $2; }
    ;

%%
